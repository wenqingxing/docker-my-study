
Dockerfile定义卷
jekyll：
VOLUME [ "/data", "/var/www/html" ]
apache：
VOLUME [ "/var/www/html" ]

Dockerfile创建的这个VOLUME,会在本机同步被创建
不会随着容器删除而删除

docker run -v $PWD:/data/ --name james_blog jamtur01/jekyll
没有-d，表示没有在后台运行

docker run -d -P --volumes-from james_blog jamtur01/apache

从定义卷的容器中共享卷
docker run -d -P --volumes-from james_blog jamtur01/apache
--volumes-from：把指定容器里的所有卷都加入新创建的容器里
前提是容器必须存在
**即使删除了使用卷的最后一个容器，卷中的数据也会持久保存。

更新代码后，需要重启容器。
docker  restart james_blog

查看卷
docker volume ls
docker volume inspect 卷id

删除卷
docker volume rm 卷id

备份卷
docker run --rm --volumes-from james_blog -v $(pwd):/backup ubuntu tar cvf /backup/james_blog_bakup.tar /var/www/html

Volume 太长了，起个别名
docker run -d -v mysql:/var/lov/mysql --name mysql1 -e MYSQL_ALLOW_EMPTY_PASSWORD=true mysql

docker volume ls 查看现有卷，发现VOLUME名变成自定义的mysql

删掉mysql1容器，在用docker volume ls查看，发现mysql卷依然存在。

数据持久化
docker run -v /home/aaa:/root/aaa  ......
和前一个方法不同，前一种方法是在Dockerfile中定义volume
下面的方法是，本地目录和容器的目录绑定



$ docker run --name some-mysql -v /my/own/datadir:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag


实例：

启动mysql容器
docker run -d  --name mysql -v mysql-data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root -e MYSQL_DATABASE=wordpress mysql

启动workpress容器
docker run -d -e WORDPRESS_DB_HOST=mysql:3306 --link mysql -p 8080:80 wordpress


***apache容器是不需要更新的
============================================================================
jekyll Dockerfile

FROM ubuntu:16.04
MAINTAINER James Turnbull <james@example.com>
ENV REFRESHED_AT 2016-06-01

RUN apt-get -qq update
RUN apt-get -qq install ruby ruby-dev build-essential nodejs
RUN gem install --no-rdoc --no-ri jekyll -v 2.5.3

VOLUME [ "/data", "/var/www/html" ]
WORKDIR /data

ENTRYPOINT [ "jekyll", "build", "--destination=/var/www/html", "--watch" ]

运行容器
docker run -v $PWD:/data/ --name james_blog jamtur01/jekyll
============================================================================
 
apache Dockerfile

FROM ubuntu:16.04
MAINTAINER James Turnbull <james@example.com>

RUN apt-get -qq update
RUN apt-get -qq install apache2

VOLUME [ "/var/www/html" ]
WORKDIR /var/www/html

ENV APACHE_RUN_USER www-data
ENV APACHE_RUN_GROUP www-data
ENV APACHE_LOG_DIR /var/log/apache2
ENV APACHE_PID_FILE /var/run/apache2.pid
ENV APACHE_RUN_DIR /var/run/apache2
ENV APACHE_LOCK_DIR /var/lock/apache2

RUN mkdir -p $APACHE_LOG_DIR $APACHE_RUN_DIR $APACHE_LOCK_DIR

EXPOSE 80

ENTRYPOINT [ "/usr/sbin/apache2" ]

运行容器
docker run -d -P --volumes-from james_blog jamtur01/apache
============================================================================




